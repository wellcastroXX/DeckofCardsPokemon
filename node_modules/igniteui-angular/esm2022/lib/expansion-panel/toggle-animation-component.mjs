import { Directive, EventEmitter, Inject } from '@angular/core';
import { noop, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { IgxAngularAnimationService } from '../services/animation/angular-animation-service';
import { growVerIn, growVerOut } from 'igniteui-angular/animations';
import * as i0 from "@angular/core";
/** @hidden @internal */
export var ANIMATION_TYPE;
(function (ANIMATION_TYPE) {
    ANIMATION_TYPE["OPEN"] = "open";
    ANIMATION_TYPE["CLOSE"] = "close";
})(ANIMATION_TYPE || (ANIMATION_TYPE = {}));
/**@hidden @internal */
// eslint-disable-next-line @angular-eslint/directive-class-suffix
export class ToggleAnimationPlayer {
    get animationSettings() {
        return this._animationSettings;
    }
    set animationSettings(value) {
        this._animationSettings = value;
    }
    constructor(animationService) {
        this.animationService = animationService;
        /** @hidden @internal */
        this.openAnimationDone = new EventEmitter();
        /** @hidden @internal */
        this.closeAnimationDone = new EventEmitter();
        /** @hidden @internal */
        this.openAnimationStart = new EventEmitter();
        /** @hidden @internal */
        this.closeAnimationStart = new EventEmitter();
        /** @hidden @internal */
        this.openAnimationPlayer = null;
        /** @hidden @internal */
        this.closeAnimationPlayer = null;
        this.destroy$ = new Subject();
        this.players = new Map();
        this._animationSettings = {
            openAnimation: growVerIn,
            closeAnimation: growVerOut
        };
        this.closeInterrupted = false;
        this.openInterrupted = false;
        this._defaultClosedCallback = noop;
        this._defaultOpenedCallback = noop;
        this.onClosedCallback = this._defaultClosedCallback;
        this.onOpenedCallback = this._defaultOpenedCallback;
    }
    /** @hidden @internal */
    playOpenAnimation(targetElement, onDone) {
        this.startPlayer(ANIMATION_TYPE.OPEN, targetElement, onDone || this._defaultOpenedCallback);
    }
    /** @hidden @internal */
    playCloseAnimation(targetElement, onDone) {
        this.startPlayer(ANIMATION_TYPE.CLOSE, targetElement, onDone || this._defaultClosedCallback);
    }
    /** @hidden @internal */
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    startPlayer(type, targetElement, callback) {
        if (!targetElement) { // if no element is passed, there is nothing to animate
            return;
        }
        let target = this.getPlayer(type);
        if (!target) {
            target = this.initializePlayer(type, targetElement, callback);
        }
        // V.S. Jun 28th, 2021 #9783: player will NOT be initialized w/ null settings
        // events will already be emitted
        if (!target || target.hasStarted()) {
            return;
        }
        const targetEmitter = type === ANIMATION_TYPE.OPEN ? this.openAnimationStart : this.closeAnimationStart;
        targetEmitter.emit();
        if (target) {
            target.play();
        }
    }
    initializePlayer(type, targetElement, callback) {
        const oppositeType = type === ANIMATION_TYPE.OPEN ? ANIMATION_TYPE.CLOSE : ANIMATION_TYPE.OPEN;
        // V.S. Jun 28th, 2021 #9783: Treat falsy animation settings as disabled animations
        const targetAnimationSettings = this.animationSettings || { closeAnimation: null, openAnimation: null };
        const animationSettings = type === ANIMATION_TYPE.OPEN ?
            targetAnimationSettings.openAnimation : targetAnimationSettings.closeAnimation;
        // V.S. Jun 28th, 2021 #9783: When no animation in target direction, emit start and done events and return
        if (!animationSettings) {
            this.setCallback(type, callback);
            const targetEmitter = type === ANIMATION_TYPE.OPEN ? this.openAnimationStart : this.closeAnimationStart;
            targetEmitter.emit();
            this.onDoneHandler(type);
            return;
        }
        const opposite = this.getPlayer(oppositeType);
        let oppositePosition = 1;
        if (opposite) {
            oppositePosition = opposite.position;
            this.cleanUpPlayer(oppositeType);
        }
        if (type === ANIMATION_TYPE.OPEN) {
            this.openAnimationPlayer = this.animationService.buildAnimation(animationSettings, targetElement.nativeElement);
        }
        else if (type === ANIMATION_TYPE.CLOSE) {
            this.closeAnimationPlayer = this.animationService.buildAnimation(animationSettings, targetElement.nativeElement);
        }
        const target = this.getPlayer(type);
        target.init();
        this.getPlayer(type).position = 1 - oppositePosition;
        this.setCallback(type, callback);
        target.animationEnd.pipe(takeUntil(this.destroy$)).subscribe(() => {
            this.onDoneHandler(type);
        });
        return target;
    }
    onDoneHandler(type) {
        const targetEmitter = type === ANIMATION_TYPE.OPEN ? this.openAnimationDone : this.closeAnimationDone;
        const targetCallback = type === ANIMATION_TYPE.OPEN ? this.onOpenedCallback : this.onClosedCallback;
        targetCallback();
        if (!(type === ANIMATION_TYPE.OPEN ? this.openInterrupted : this.closeInterrupted)) {
            targetEmitter.emit();
        }
        this.cleanUpPlayer(type);
    }
    setCallback(type, callback) {
        if (type === ANIMATION_TYPE.OPEN) {
            this.onOpenedCallback = callback;
            this.openInterrupted = false;
        }
        else if (type === ANIMATION_TYPE.CLOSE) {
            this.onClosedCallback = callback;
            this.closeInterrupted = false;
        }
    }
    cleanUpPlayer(target) {
        switch (target) {
            case ANIMATION_TYPE.CLOSE:
                if (this.closeAnimationPlayer != null) {
                    this.closeAnimationPlayer.reset();
                    this.closeAnimationPlayer.destroy();
                    this.closeAnimationPlayer = null;
                }
                this.closeInterrupted = true;
                this.onClosedCallback = this._defaultClosedCallback;
                break;
            case ANIMATION_TYPE.OPEN:
                if (this.openAnimationPlayer != null) {
                    this.openAnimationPlayer.reset();
                    this.openAnimationPlayer.destroy();
                    this.openAnimationPlayer = null;
                }
                this.openInterrupted = true;
                this.onOpenedCallback = this._defaultOpenedCallback;
                break;
            default:
                break;
        }
    }
    getPlayer(type) {
        switch (type) {
            case ANIMATION_TYPE.OPEN:
                return this.openAnimationPlayer;
            case ANIMATION_TYPE.CLOSE:
                return this.closeAnimationPlayer;
            default:
                return null;
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: ToggleAnimationPlayer, deps: [{ token: IgxAngularAnimationService }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.2.4", type: ToggleAnimationPlayer, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: ToggleAnimationPlayer, decorators: [{
            type: Directive
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [IgxAngularAnimationService]
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9nZ2xlLWFuaW1hdGlvbi1jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZ25pdGV1aS1hbmd1bGFyL3NyYy9saWIvZXhwYW5zaW9uLXBhbmVsL3RvZ2dsZS1hbmltYXRpb24tY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQWMsWUFBWSxFQUFFLE1BQU0sRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUN2RixPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0saURBQWlELENBQUM7QUFFN0YsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQzs7QUFvQnBFLHdCQUF3QjtBQUN4QixNQUFNLENBQU4sSUFBWSxjQUdYO0FBSEQsV0FBWSxjQUFjO0lBQ3RCLCtCQUFhLENBQUE7SUFDYixpQ0FBZSxDQUFBO0FBQ25CLENBQUMsRUFIVyxjQUFjLEtBQWQsY0FBYyxRQUd6QjtBQUVELHVCQUF1QjtBQUV2QixrRUFBa0U7QUFDbEUsTUFBTSxPQUFnQixxQkFBcUI7SUFVdkMsSUFBVyxpQkFBaUI7UUFDeEIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUM7SUFDbkMsQ0FBQztJQUNELElBQVcsaUJBQWlCLENBQUMsS0FBOEI7UUFDdkQsSUFBSSxDQUFDLGtCQUFrQixHQUFHLEtBQUssQ0FBQztJQUNwQyxDQUFDO0lBdUJELFlBQTBELGdCQUFrQztRQUFsQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBckM1Rix3QkFBd0I7UUFDakIsc0JBQWlCLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEUsd0JBQXdCO1FBQ2pCLHVCQUFrQixHQUF1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Q1Y7Z0JBQ0ksTUFBTTtTQUNiO0lBQ0wsQ0FBQztJQUVPLFNBQVMsQ0FBQyxJQUFvQjtRQUNsQyxRQUFRLElBQUksRUFBRTtZQUNWLEtBQUssY0FBYyxDQUFDLElBQUk7Z0JBQ3BCLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDO1lBQ3BDLEtBQUssY0FBYyxDQUFDLEtBQUs7Z0JBQ3JCLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDO1lBQ3JDO2dCQUNJLE9BQU8sSUFBSSxDQUFDO1NBQ25CO0lBQ0wsQ0FBQzs4R0F0S2lCLHFCQUFxQixrQkFzQ25CLDBCQUEwQjtrR0F0QzVCLHFCQUFxQjs7MkZBQXJCLHFCQUFxQjtrQkFGMUMsU0FBUzs7MEJBd0NPLE1BQU07MkJBQUMsMEJBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQW5pbWF0aW9uUmVmZXJlbmNlTWV0YWRhdGEgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbmplY3QsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgbm9vcCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBJZ3hBbmd1bGFyQW5pbWF0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2FuaW1hdGlvbi9hbmd1bGFyLWFuaW1hdGlvbi1zZXJ2aWNlJztcbmltcG9ydCB7IEFuaW1hdGlvblBsYXllciwgQW5pbWF0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2FuaW1hdGlvbi9hbmltYXRpb24nO1xuaW1wb3J0IHsgZ3Jvd1ZlckluLCBncm93VmVyT3V0IH0gZnJvbSAnaWduaXRldWktYW5ndWxhci9hbmltYXRpb25zJztcblxuLyoqQGhpZGRlbiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBpbnRlcmZhY2UgVG9nZ2xlQW5pbWF0aW9uU2V0dGluZ3Mge1xuICAgIG9wZW5BbmltYXRpb246IEFuaW1hdGlvblJlZmVyZW5jZU1ldGFkYXRhO1xuICAgIGNsb3NlQW5pbWF0aW9uOiBBbmltYXRpb25SZWZlcmVuY2VNZXRhZGF0YTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb2dnbGVBbmltYXRpb25Pd25lciB7XG4gICAgYW5pbWF0aW9uU2V0dGluZ3M6IFRvZ2dsZUFuaW1hdGlvblNldHRpbmdzO1xuICAgIG9wZW5BbmltYXRpb25TdGFydDogRXZlbnRFbWl0dGVyPHZvaWQ+O1xuICAgIG9wZW5BbmltYXRpb25Eb25lOiBFdmVudEVtaXR0ZXI8dm9pZD47XG4gICAgY2xvc2VBbmltYXRpb25TdGFydDogRXZlbnRFbWl0dGVyPHZvaWQ+O1xuICAgIGNsb3NlQW5pbWF0aW9uRG9uZTogRXZlbnRFbWl0dGVyPHZvaWQ+O1xuICAgIG9wZW5BbmltYXRpb25QbGF5ZXI6IEFuaW1hdGlvblBsYXllcjtcbiAgICBjbG9zZUFuaW1hdGlvblBsYXllcjogQW5pbWF0aW9uUGxheWVyO1xuICAgIHBsYXlPcGVuQW5pbWF0aW9uKGVsZW1lbnQ6IEVsZW1lbnRSZWYsIG9uRG9uZTogKCkgPT4gdm9pZCk6IHZvaWQ7XG4gICAgcGxheUNsb3NlQW5pbWF0aW9uKGVsZW1lbnQ6IEVsZW1lbnRSZWYsIG9uRG9uZTogKCkgPT4gdm9pZCk6IHZvaWQ7XG59XG5cbi8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGVudW0gQU5JTUFUSU9OX1RZUEUge1xuICAgIE9QRU4gPSAnb3BlbicsXG4gICAgQ0xPU0UgPSAnY2xvc2UnLFxufVxuXG4vKipAaGlkZGVuIEBpbnRlcm5hbCAqL1xuQERpcmVjdGl2ZSgpXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L2RpcmVjdGl2ZS1jbGFzcy1zdWZmaXhcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBUb2dnbGVBbmltYXRpb25QbGF5ZXIgaW1wbGVtZW50cyBUb2dnbGVBbmltYXRpb25Pd25lciwgT25EZXN0cm95IHtcbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgb3BlbkFuaW1hdGlvbkRvbmU6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgY2xvc2VBbmltYXRpb25Eb25lOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIG9wZW5BbmltYXRpb25TdGFydDogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBjbG9zZUFuaW1hdGlvblN0YXJ0OiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBwdWJsaWMgZ2V0IGFuaW1hdGlvblNldHRpbmdzKCk6IFRvZ2dsZUFuaW1hdGlvblNldHRpbmdzIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1hdGlvblNldHRpbmdzO1xuICAgIH1cbiAgICBwdWJsaWMgc2V0IGFuaW1hdGlvblNldHRpbmdzKHZhbHVlOiBUb2dnbGVBbmltYXRpb25TZXR0aW5ncykge1xuICAgICAgICB0aGlzLl9hbmltYXRpb25TZXR0aW5ncyA9IHZhbHVlO1xuICAgIH1cblxuICAgIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBvcGVuQW5pbWF0aW9uUGxheWVyOiBBbmltYXRpb25QbGF5ZXIgPSBudWxsO1xuXG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIGNsb3NlQW5pbWF0aW9uUGxheWVyOiBBbmltYXRpb25QbGF5ZXIgPSBudWxsO1xuXG4gICAgcHJvdGVjdGVkIGRlc3Ryb3kkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcbiAgICBwcm90ZWN0ZWQgcGxheWVyczogTWFwPHN0cmluZywgQW5pbWF0aW9uUGxheWVyPiA9IG5ldyBNYXAoKTtcbiAgICBwcm90ZWN0ZWQgX2FuaW1hdGlvblNldHRpbmdzOiBUb2dnbGVBbmltYXRpb25TZXR0aW5ncyA9IHtcbiAgICAgICAgb3BlbkFuaW1hdGlvbjogZ3Jvd1ZlckluLFxuICAgICAgICBjbG9zZUFuaW1hdGlvbjogZ3Jvd1Zlck91dFxuICAgIH07XG5cbiAgICBwcml2YXRlIGNsb3NlSW50ZXJydXB0ZWQgPSBmYWxzZTtcbiAgICBwcml2YXRlIG9wZW5JbnRlcnJ1cHRlZCA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBfZGVmYXVsdENsb3NlZENhbGxiYWNrID0gbm9vcDtcbiAgICBwcml2YXRlIF9kZWZhdWx0T3BlbmVkQ2FsbGJhY2sgPSBub29wO1xuICAgIHByaXZhdGUgb25DbG9zZWRDYWxsYmFjazogKCkgPT4gYW55ID0gdGhpcy5fZGVmYXVsdENsb3NlZENhbGxiYWNrO1xuICAgIHByaXZhdGUgb25PcGVuZWRDYWxsYmFjazogKCkgPT4gYW55ID0gdGhpcy5fZGVmYXVsdE9wZW5lZENhbGxiYWNrO1xuXG4gICAgY29uc3RydWN0b3IoQEluamVjdChJZ3hBbmd1bGFyQW5pbWF0aW9uU2VydmljZSkgcHJvdGVjdGVkIGFuaW1hdGlvblNlcnZpY2U6IEFuaW1hdGlvblNlcnZpY2UpIHtcbiAgICB9XG5cbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgcGxheU9wZW5BbmltYXRpb24odGFyZ2V0RWxlbWVudDogRWxlbWVudFJlZiwgb25Eb25lPzogKCkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXJ0UGxheWVyKEFOSU1BVElPTl9UWVBFLk9QRU4sIHRhcmdldEVsZW1lbnQsIG9uRG9uZSB8fCB0aGlzLl9kZWZhdWx0T3BlbmVkQ2FsbGJhY2spO1xuICAgIH1cblxuICAgIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBwbGF5Q2xvc2VBbmltYXRpb24odGFyZ2V0RWxlbWVudDogRWxlbWVudFJlZiwgb25Eb25lPzogKCkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXJ0UGxheWVyKEFOSU1BVElPTl9UWVBFLkNMT1NFLCB0YXJnZXRFbGVtZW50LCBvbkRvbmUgfHwgdGhpcy5fZGVmYXVsdENsb3NlZENhbGxiYWNrKTtcbiAgICB9XG5cbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgICAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGFydFBsYXllcih0eXBlOiBBTklNQVRJT05fVFlQRSwgdGFyZ2V0RWxlbWVudDogRWxlbWVudFJlZiwgY2FsbGJhY2s6ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0YXJnZXRFbGVtZW50KSB7IC8vIGlmIG5vIGVsZW1lbnQgaXMgcGFzc2VkLCB0aGVyZSBpcyBub3RoaW5nIHRvIGFuaW1hdGVcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFyZ2V0ID0gdGhpcy5nZXRQbGF5ZXIodHlwZSk7XG4gICAgICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSB0aGlzLmluaXRpYWxpemVQbGF5ZXIodHlwZSwgdGFyZ2V0RWxlbWVudCwgY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgICAgIC8vIFYuUy4gSnVuIDI4dGgsIDIwMjEgIzk3ODM6IHBsYXllciB3aWxsIE5PVCBiZSBpbml0aWFsaXplZCB3LyBudWxsIHNldHRpbmdzXG4gICAgICAgIC8vIGV2ZW50cyB3aWxsIGFscmVhZHkgYmUgZW1pdHRlZFxuICAgICAgICBpZiAoIXRhcmdldCB8fCB0YXJnZXQuaGFzU3RhcnRlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGFyZ2V0RW1pdHRlciA9IHR5cGUgPT09IEFOSU1BVElPTl9UWVBFLk9QRU4gPyB0aGlzLm9wZW5BbmltYXRpb25TdGFydCA6IHRoaXMuY2xvc2VBbmltYXRpb25TdGFydDtcbiAgICAgICAgdGFyZ2V0RW1pdHRlci5lbWl0KCk7XG4gICAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgICAgIHRhcmdldC5wbGF5KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRpYWxpemVQbGF5ZXIodHlwZTogQU5JTUFUSU9OX1RZUEUsIHRhcmdldEVsZW1lbnQ6IEVsZW1lbnRSZWYsIGNhbGxiYWNrOiAoKSA9PiB2b2lkKTogQW5pbWF0aW9uUGxheWVyIHtcbiAgICAgICAgY29uc3Qgb3Bwb3NpdGVUeXBlID0gdHlwZSA9PT0gQU5JTUFUSU9OX1RZUEUuT1BFTiA/IEFOSU1BVElPTl9UWVBFLkNMT1NFIDogQU5JTUFUSU9OX1RZUEUuT1BFTjtcbiAgICAgICAgLy8gVi5TLiBKdW4gMjh0aCwgMjAyMSAjOTc4MzogVHJlYXQgZmFsc3kgYW5pbWF0aW9uIHNldHRpbmdzIGFzIGRpc2FibGVkIGFuaW1hdGlvbnNcbiAgICAgICAgY29uc3QgdGFyZ2V0QW5pbWF0aW9uU2V0dGluZ3MgPSB0aGlzLmFuaW1hdGlvblNldHRpbmdzIHx8IHsgY2xvc2VBbmltYXRpb246IG51bGwsIG9wZW5BbmltYXRpb246IG51bGwgfTtcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uU2V0dGluZ3MgPSB0eXBlID09PSBBTklNQVRJT05fVFlQRS5PUEVOID9cbiAgICAgICAgICAgIHRhcmdldEFuaW1hdGlvblNldHRpbmdzLm9wZW5BbmltYXRpb24gOiB0YXJnZXRBbmltYXRpb25TZXR0aW5ncy5jbG9zZUFuaW1hdGlvbjtcbiAgICAgICAgLy8gVi5TLiBKdW4gMjh0aCwgMjAyMSAjOTc4MzogV2hlbiBubyBhbmltYXRpb24gaW4gdGFyZ2V0IGRpcmVjdGlvbiwgZW1pdCBzdGFydCBhbmQgZG9uZSBldmVudHMgYW5kIHJldHVyblxuICAgICAgICBpZiAoIWFuaW1hdGlvblNldHRpbmdzKSB7XG4gICAgICAgICAgICB0aGlzLnNldENhbGxiYWNrKHR5cGUsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldEVtaXR0ZXIgPSB0eXBlID09PSBBTklNQVRJT05fVFlQRS5PUEVOID8gdGhpcy5vcGVuQW5pbWF0aW9uU3RhcnQgOiB0aGlzLmNsb3NlQW5pbWF0aW9uU3RhcnQ7XG4gICAgICAgICAgICB0YXJnZXRFbWl0dGVyLmVtaXQoKTtcbiAgICAgICAgICAgIHRoaXMub25Eb25lSGFuZGxlcih0eXBlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvcHBvc2l0ZSA9IHRoaXMuZ2V0UGxheWVyKG9wcG9zaXRlVHlwZSk7XG4gICAgICAgIGxldCBvcHBvc2l0ZVBvc2l0aW9uID0gMTtcbiAgICAgICAgaWYgKG9wcG9zaXRlKSB7XG4gICAgICAgICAgICBvcHBvc2l0ZVBvc2l0aW9uID0gb3Bwb3NpdGUucG9zaXRpb247XG4gICAgICAgICAgICB0aGlzLmNsZWFuVXBQbGF5ZXIob3Bwb3NpdGVUeXBlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZSA9PT0gQU5JTUFUSU9OX1RZUEUuT1BFTikge1xuICAgICAgICAgICAgdGhpcy5vcGVuQW5pbWF0aW9uUGxheWVyID0gdGhpcy5hbmltYXRpb25TZXJ2aWNlLmJ1aWxkQW5pbWF0aW9uKGFuaW1hdGlvblNldHRpbmdzLCB0YXJnZXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IEFOSU1BVElPTl9UWVBFLkNMT1NFKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlQW5pbWF0aW9uUGxheWVyID0gdGhpcy5hbmltYXRpb25TZXJ2aWNlLmJ1aWxkQW5pbWF0aW9uKGFuaW1hdGlvblNldHRpbmdzLCB0YXJnZXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZ2V0UGxheWVyKHR5cGUpO1xuICAgICAgICB0YXJnZXQuaW5pdCgpO1xuICAgICAgICB0aGlzLmdldFBsYXllcih0eXBlKS5wb3NpdGlvbiA9IDEgLSBvcHBvc2l0ZVBvc2l0aW9uO1xuICAgICAgICB0aGlzLnNldENhbGxiYWNrKHR5cGUsIGNhbGxiYWNrKTtcbiAgICAgICAgdGFyZ2V0LmFuaW1hdGlvbkVuZC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMub25Eb25lSGFuZGxlcih0eXBlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkRvbmVIYW5kbGVyKHR5cGUpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0RW1pdHRlciA9IHR5cGUgPT09IEFOSU1BVElPTl9UWVBFLk9QRU4gPyB0aGlzLm9wZW5BbmltYXRpb25Eb25lIDogdGhpcy5jbG9zZUFuaW1hdGlvbkRvbmU7XG4gICAgICAgIGNvbnN0IHRhcmdldENhbGxiYWNrID0gdHlwZSA9PT0gQU5JTUFUSU9OX1RZUEUuT1BFTiA/IHRoaXMub25PcGVuZWRDYWxsYmFjayA6IHRoaXMub25DbG9zZWRDYWxsYmFjaztcbiAgICAgICAgdGFyZ2V0Q2FsbGJhY2soKTtcbiAgICAgICAgaWYgKCEodHlwZSA9PT0gQU5JTUFUSU9OX1RZUEUuT1BFTiA/IHRoaXMub3BlbkludGVycnVwdGVkIDogdGhpcy5jbG9zZUludGVycnVwdGVkKSkge1xuICAgICAgICAgICAgdGFyZ2V0RW1pdHRlci5lbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGVhblVwUGxheWVyKHR5cGUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0Q2FsbGJhY2sodHlwZTogQU5JTUFUSU9OX1RZUEUsIGNhbGxiYWNrOiAoKSA9PiB2b2lkKSB7XG4gICAgICAgIGlmICh0eXBlID09PSBBTklNQVRJT05fVFlQRS5PUEVOKSB7XG4gICAgICAgICAgICB0aGlzLm9uT3BlbmVkQ2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgICAgIHRoaXMub3BlbkludGVycnVwdGVkID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gQU5JTUFUSU9OX1RZUEUuQ0xPU0UpIHtcbiAgICAgICAgICAgIHRoaXMub25DbG9zZWRDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgdGhpcy5jbG9zZUludGVycnVwdGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNsZWFuVXBQbGF5ZXIodGFyZ2V0OiBBTklNQVRJT05fVFlQRSkge1xuICAgICAgICBzd2l0Y2ggKHRhcmdldCkge1xuICAgICAgICAgICAgY2FzZSBBTklNQVRJT05fVFlQRS5DTE9TRTpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbG9zZUFuaW1hdGlvblBsYXllciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VBbmltYXRpb25QbGF5ZXIucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUFuaW1hdGlvblBsYXllci5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VBbmltYXRpb25QbGF5ZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlSW50ZXJydXB0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMub25DbG9zZWRDYWxsYmFjayA9IHRoaXMuX2RlZmF1bHRDbG9zZWRDYWxsYmFjaztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQU5JTUFUSU9OX1RZUEUuT1BFTjpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcGVuQW5pbWF0aW9uUGxheWVyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQW5pbWF0aW9uUGxheWVyLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3BlbkFuaW1hdGlvblBsYXllci5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3BlbkFuaW1hdGlvblBsYXllciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMub3BlbkludGVycnVwdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uT3BlbmVkQ2FsbGJhY2sgPSB0aGlzLl9kZWZhdWx0T3BlbmVkQ2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQbGF5ZXIodHlwZTogQU5JTUFUSU9OX1RZUEUpOiBBbmltYXRpb25QbGF5ZXIge1xuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQU5JTUFUSU9OX1RZUEUuT1BFTjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVuQW5pbWF0aW9uUGxheWVyO1xuICAgICAgICAgICAgY2FzZSBBTklNQVRJT05fVFlQRS5DTE9TRTpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9zZUFuaW1hdGlvblBsYXllcjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=