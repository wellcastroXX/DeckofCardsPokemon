import { ExportUtilities } from '../exporter-common/export-utilities';
/** @hidden */
export class WorksheetDataDictionary {
    static { this.DEFAULT_FONT = '11pt Calibri'; }
    static { this.TEXT_PADDING = 5; }
    constructor(columnCount, columnWidth, columnWidthsList) {
        this.hasNumberValues = false;
        this.hasDateValues = false;
        this._dictionary = {};
        this._widthsDictionary = {};
        this._counter = 0;
        this.dirtyKeyCollections();
        this._columnWidths = new Array(columnCount);
        if (columnWidth) {
            this._columnWidths.fill(columnWidth);
        }
        else {
            this._columnWidths = columnWidthsList;
        }
        this.stringsCount = 0;
    }
    get columnWidths() {
        return this._columnWidths;
    }
    saveValue(value, isHeader, shouldSanitizeValue = true) {
        let sanitizedValue = '';
        const isDate = value instanceof Date;
        const isSavedAsString = isHeader || (typeof value !== 'number' && value !== Number(value) && !Number.isFinite(value) && !isDate);
        if (isSavedAsString) {
            sanitizedValue = shouldSanitizeValue ? ExportUtilities.sanitizeValue(value) : value;
            if (this._dictionary[sanitizedValue] === undefined) {
                this._dictionary[sanitizedValue] = this._counter++;
                this.dirtyKeyCollections();
            }
            this.stringsCount++;
        }
        else if (isDate) {
            this.hasDateValues = true;
        }
        else {
            this.hasNumberValues = true;
        }
        return isSavedAsString ? this.getSanitizedValue(sanitizedValue) : -1;
    }
    getValue(value) {
        return this.getSanitizedValue(ExportUtilities.sanitizeValue(value));
    }
    getSanitizedValue(sanitizedValue) {
        return this._dictionary[sanitizedValue];
    }
    getKeys() {
        if (!this._keysAreValid) {
            this._keys = Object.keys(this._dictionary);
            this._keysAreValid = true;
        }
        return this._keys;
    }
    getTextWidth(value) {
        if (this._widthsDictionary[value] === undefined) {
            const context = this.getContext();
            const metrics = context.measureText(value);
            this._widthsDictionary[value] = metrics.width + WorksheetDataDictionary.TEXT_PADDING;
        }
        return this._widthsDictionary[value];
    }
    getContext() {
        if (!this._context) {
            const canvas = document.createElement('canvas');
            this._context = canvas.getContext('2d');
            this._context.font = WorksheetDataDictionary.DEFAULT_FONT;
        }
        return this._context;
    }
    dirtyKeyCollections() {
        this._keysAreValid = false;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya3NoZWV0LWRhdGEtZGljdGlvbmFyeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lnbml0ZXVpLWFuZ3VsYXIvc3JjL2xpYi9zZXJ2aWNlcy9leGNlbC93b3Jrc2hlZXQtZGF0YS1kaWN0aW9uYXJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUV0RSxjQUFjO0FBQ2QsTUFBTSxPQUFPLHVCQUF1QjthQUNqQixpQkFBWSxHQUFHLGNBQWMsQUFBakIsQ0FBa0I7YUFDOUIsaUJBQVksR0FBRyxDQUFDLEFBQUosQ0FBSztJQWlCaEMsWUFBWSxXQUFtQixFQUFFLFdBQW1CLEVBQUUsZ0JBQTBCO1FBZnpFLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBZXpCLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUM7UUFDbEIsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFFM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLEtBQUssQ0FBUyxXQUFXLENBQUMsQ0FBQztRQUVwRCxJQUFJLFdBQVcsRUFBRTtZQUNiLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3hDO2FBQU07WUFDSCxJQUFJLENBQUMsYUFBYSxHQUFHLGdCQUFnQixDQUFDO1NBQ3pDO1FBRUQsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVELElBQVcsWUFBWTtRQUNuQixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUM7SUFDOUIsQ0FBQztJQUVNLFNBQVMsQ0FBQyxLQUFVLEVBQUUsUUFBaUIsRUFBRSxt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Q0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV4cG9ydFV0aWxpdGllcyB9IGZyb20gJy4uL2V4cG9ydGVyLWNvbW1vbi9leHBvcnQtdXRpbGl0aWVzJztcblxuLyoqIEBoaWRkZW4gKi9cbmV4cG9ydCBjbGFzcyBXb3Jrc2hlZXREYXRhRGljdGlvbmFyeSB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgREVGQVVMVF9GT05UID0gJzExcHQgQ2FsaWJyaSc7XG4gICAgcHJpdmF0ZSBzdGF0aWMgVEVYVF9QQURESU5HID0gNTtcblxuICAgIHB1YmxpYyBoYXNOdW1iZXJWYWx1ZXMgPSBmYWxzZTtcbiAgICBwdWJsaWMgaGFzRGF0ZVZhbHVlcyA9IGZhbHNlO1xuXG4gICAgcHVibGljIHN0cmluZ3NDb3VudDogbnVtYmVyO1xuXG4gICAgcHJpdmF0ZSBfZGljdGlvbmFyeTogYW55O1xuICAgIHByaXZhdGUgX3dpZHRoc0RpY3Rpb25hcnk6IGFueTtcblxuICAgIHByaXZhdGUgX2tleXM6IHN0cmluZ1tdO1xuICAgIHByaXZhdGUgX2tleXNBcmVWYWxpZDogYm9vbGVhbjtcblxuICAgIHByaXZhdGUgX2NvdW50ZXI6IG51bWJlcjtcbiAgICBwcml2YXRlIF9jb2x1bW5XaWR0aHM6IG51bWJlcltdO1xuICAgIHByaXZhdGUgX2NvbnRleHQ6IGFueTtcblxuICAgIGNvbnN0cnVjdG9yKGNvbHVtbkNvdW50OiBudW1iZXIsIGNvbHVtbldpZHRoOiBudW1iZXIsIGNvbHVtbldpZHRoc0xpc3Q6IG51bWJlcltdKSB7XG4gICAgICAgIHRoaXMuX2RpY3Rpb25hcnkgPSB7fTtcbiAgICAgICAgdGhpcy5fd2lkdGhzRGljdGlvbmFyeSA9IHt9O1xuICAgICAgICB0aGlzLl9jb3VudGVyID0gMDtcbiAgICAgICAgdGhpcy5kaXJ0eUtleUNvbGxlY3Rpb25zKCk7XG5cbiAgICAgICAgdGhpcy5fY29sdW1uV2lkdGhzID0gbmV3IEFycmF5PG51bWJlcj4oY29sdW1uQ291bnQpO1xuXG4gICAgICAgIGlmIChjb2x1bW5XaWR0aCkge1xuICAgICAgICAgICAgdGhpcy5fY29sdW1uV2lkdGhzLmZpbGwoY29sdW1uV2lkdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY29sdW1uV2lkdGhzID0gY29sdW1uV2lkdGhzTGlzdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc3RyaW5nc0NvdW50ID0gMDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGNvbHVtbldpZHRocygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbHVtbldpZHRocztcbiAgICB9XG5cbiAgICBwdWJsaWMgc2F2ZVZhbHVlKHZhbHVlOiBhbnksIGlzSGVhZGVyOiBib29sZWFuLCBzaG91bGRTYW5pdGl6ZVZhbHVlID0gdHJ1ZSk6IG51bWJlciB7XG4gICAgICAgIGxldCBzYW5pdGl6ZWRWYWx1ZSA9ICcnO1xuICAgICAgICBjb25zdCBpc0RhdGUgPSB2YWx1ZSBpbnN0YW5jZW9mIERhdGU7XG4gICAgICAgIGNvbnN0IGlzU2F2ZWRBc1N0cmluZyA9IGlzSGVhZGVyIHx8ICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInICYmIHZhbHVlICE9PSBOdW1iZXIodmFsdWUpICYmICFOdW1iZXIuaXNGaW5pdGUodmFsdWUpICYmICFpc0RhdGUpO1xuXG4gICAgICAgIGlmIChpc1NhdmVkQXNTdHJpbmcpIHtcbiAgICAgICAgICAgIHNhbml0aXplZFZhbHVlID0gc2hvdWxkU2FuaXRpemVWYWx1ZSA/IEV4cG9ydFV0aWxpdGllcy5zYW5pdGl6ZVZhbHVlKHZhbHVlKSA6IHZhbHVlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5fZGljdGlvbmFyeVtzYW5pdGl6ZWRWYWx1ZV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RpY3Rpb25hcnlbc2FuaXRpemVkVmFsdWVdID0gdGhpcy5fY291bnRlcisrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlydHlLZXlDb2xsZWN0aW9ucygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnN0cmluZ3NDb3VudCArKztcbiAgICAgICAgfSBlbHNlIGlmIChpc0RhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuaGFzRGF0ZVZhbHVlcyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmhhc051bWJlclZhbHVlcyA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaXNTYXZlZEFzU3RyaW5nID8gdGhpcy5nZXRTYW5pdGl6ZWRWYWx1ZShzYW5pdGl6ZWRWYWx1ZSkgOiAtMTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VmFsdWUodmFsdWU6IHN0cmluZyk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFNhbml0aXplZFZhbHVlKEV4cG9ydFV0aWxpdGllcy5zYW5pdGl6ZVZhbHVlKHZhbHVlKSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFNhbml0aXplZFZhbHVlKHNhbml0aXplZFZhbHVlOiBzdHJpbmcpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGljdGlvbmFyeVtzYW5pdGl6ZWRWYWx1ZV07XG4gICAgfVxuXG4gICAgcHVibGljIGdldEtleXMoKTogc3RyaW5nW10ge1xuICAgICAgICBpZiAoIXRoaXMuX2tleXNBcmVWYWxpZCkge1xuICAgICAgICAgICAgdGhpcy5fa2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuX2RpY3Rpb25hcnkpO1xuICAgICAgICAgICAgdGhpcy5fa2V5c0FyZVZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9rZXlzO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0VGV4dFdpZHRoKHZhbHVlOiBhbnkpOiBudW1iZXIge1xuICAgICAgICBpZiAodGhpcy5fd2lkdGhzRGljdGlvbmFyeVt2YWx1ZV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3QgY29udGV4dCA9IHRoaXMuZ2V0Q29udGV4dCgpO1xuICAgICAgICAgICAgY29uc3QgbWV0cmljcyA9IGNvbnRleHQubWVhc3VyZVRleHQodmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5fd2lkdGhzRGljdGlvbmFyeVt2YWx1ZV0gPSBtZXRyaWNzLndpZHRoICsgV29ya3NoZWV0RGF0YURpY3Rpb25hcnkuVEVYVF9QQURESU5HO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoc0RpY3Rpb25hcnlbdmFsdWVdO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Q29udGV4dCgpOiBhbnkge1xuICAgICAgICBpZiAoIXRoaXMuX2NvbnRleHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgdGhpcy5fY29udGV4dC5mb250ID0gV29ya3NoZWV0RGF0YURpY3Rpb25hcnkuREVGQVVMVF9GT05UO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkaXJ0eUtleUNvbGxlY3Rpb25zKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9rZXlzQXJlVmFsaWQgPSBmYWxzZTtcbiAgICB9XG59XG4iXX0=