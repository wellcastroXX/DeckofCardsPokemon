import { GridResourceStringsEN } from '../../core/i18n/grid-resources';
import { getCurrentResourceStrings } from '../../core/i18n/resources';
import { GridColumnDataType } from '../../data-operations/data-util';
import { PivotUtil } from './pivot-util';
// Equals to pretty much this configuration:
// {
//     member: () => 'All Periods',
//     enabled: true,
//     fieldName: 'AllPeriods',
//     childLevel: {
//         fieldName: 'Years',
//         member: (rec) => {
//             const recordValue = rec['Date'];
//             return recordValue ? (new Date(recordValue)).getFullYear().toString() : rec['Years'];
//         },
//         enabled: true,
//         childLevel: {
//                 member: (rec) => {
//                     const recordValue = rec['Date'];
//                     return recordValue ? new Date(recordValue).toLocaleString('default', { month: 'long' }) : rec['Months'];
//                 },
//                 enabled: true,
//                 fieldName: 'Months',
//                 childLevel: {
//                         member: 'Date',
//                         fieldName:'Date',
//                         enabled: true
//                     }
//             }
//     }
// },
export class IgxPivotDateDimension {
    /**
     * Gets/Sets the resource strings.
     *
     * @remarks
     * By default it uses EN resources.
     */
    set resourceStrings(value) {
        this._resourceStrings = Object.assign({}, this._resourceStrings, value);
    }
    get resourceStrings() {
        return this._resourceStrings;
    }
    /**
     * Gets/Sets the base dimension that is used by this class to determine the other dimensions and their values.
     * Having base dimension set is required in order for the Date Dimensions to show.
     */
    get baseDimension() {
        return this._baseDimension;
    }
    set baseDimension(value) {
        this._baseDimension = value;
        this.initialize(this.baseDimension, this.options);
    }
    /**
     * Gets/Sets the options for the predefined date dimensions whether to show quarter, years and etc.
     */
    get options() {
        return this._options;
    }
    set options(value) {
        this._options = value;
        if (this.baseDimension) {
            this.initialize(this.baseDimension, this.options);
        }
    }
    /**
     * @deprecated since version 15.1.0. Use the `baseDimension` property instead.
     *
     * Gets the base dimension that is used by this class to determine the other dimensions and their values.
     * Having base dimension set is required in order for the Date Dimensions to show.
     */
    get inBaseDimension() {
        return this._baseDimension;
    }
    /**
     * @deprecated since version 15.1.0. Use the `options` property instead.
     *
     * Gets the options for the predefined date dimensions whether to show quarter, years and etc.
     */
    get inOptions() {
        return this._options;
    }
    /**
     * Creates additional pivot date dimensions based on a provided dimension describing date data:
     *
     * @param inDateDimension Base dimension that is used by this class to determine the other dimensions and their values.
     * @param inOptions Options for the predefined date dimensions whether to show quarter, years and etc.
     * @example
     * ```typescript
     * // Displays only years as parent dimension to the base dimension provided.
     * new IgxPivotDateDimension({ memberName: 'Date', enabled: true }, { total: false, months: false });
     * ```
     */
    constructor(inBaseDimension, inOptions = {}) {
        /** Enables/Disables a particular dimension from pivot structure. */
        this.enabled = true;
        /** Default options. */
        this.defaultOptions = {
            total: true,
            years: true,
            months: true,
            fullDate: true
        };
        /** @hidden @internal */
        this.memberName = 'AllPeriods';
        this._resourceStrings = getCurrentResourceStrings(GridResourceStringsEN);
        this._options = {};
        this._monthIntl = new Intl.DateTimeFormat('default', { month: 'long' });
        /** @hidden @internal */
        this.memberFunction = (_data) => this.resourceStrings.igx_grid_pivot_date_dimension_total;
        this._baseDimension = inBaseDimension;
        this._options = inOptions;
        if (this.baseDimension && this.options) {
            this.initialize(this.baseDimension, this.options);
        }
    }
    initialize(inBaseDimension, inOptions) {
        const options = { ...this.defaultOptions, ...inOptions };
        this.dataType = GridColumnDataType.Date;
        inBaseDimension.dataType = GridColumnDataType.Date;
        this.displayName = inBaseDimension.displayName || this.resourceStrings.igx_grid_pivot_date_dimension_total;
        const baseDimension = options.fullDate ? inBaseDimension : null;
        const monthDimensionDef = {
            memberName: 'Months',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? this._monthIntl.format(new Date(recordValue)) : rec['Months'];
            },
            enabled: true,
            childLevel: baseDimension
        };
        const monthDimension = options.months ? monthDimensionDef : baseDimension;
        const quarterDimensionDef = {
            memberName: 'Quarters',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? `Q` + Math.ceil((new Date(recordValue).getMonth() + 1) / 3) : rec['Quarters'];
            },
            enabled: true,
            childLevel: monthDimension
        };
        const quarterDimension = options.quarters ? quarterDimensionDef : monthDimension;
        const yearsDimensionDef = {
            memberName: 'Years',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? (new Date(recordValue)).getFullYear().toString() : rec['Years'];
            },
            enabled: true,
            childLevel: quarterDimension
        };
        const yearsDimension = options.years ? yearsDimensionDef : quarterDimension;
        this.childLevel = yearsDimension;
        if (!options.total) {
            this.memberName = yearsDimension.memberName;
            this.memberFunction = yearsDimension.memberFunction;
            this.childLevel = yearsDimension.childLevel;
            this.displayName = yearsDimension.displayName;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGl2b3QtZ3JpZC1kaW1lbnNpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWduaXRldWktYW5ndWxhci9zcmMvbGliL2dyaWRzL3Bpdm90LWdyaWQvcGl2b3QtZ3JpZC1kaW1lbnNpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxxQkFBcUIsRUFBd0IsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM3RixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUVyRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBZXpDLDRDQUE0QztBQUM1QyxJQUFJO0FBQ0osbUNBQW1DO0FBQ25DLHFCQUFxQjtBQUNyQiwrQkFBK0I7QUFDL0Isb0JBQW9CO0FBQ3BCLDhCQUE4QjtBQUM5Qiw2QkFBNkI7QUFDN0IsK0NBQStDO0FBQy9DLG9HQUFvRztBQUNwRyxhQUFhO0FBQ2IseUJBQXlCO0FBQ3pCLHdCQUF3QjtBQUN4QixxQ0FBcUM7QUFDckMsdURBQXVEO0FBQ3ZELCtIQUErSDtBQUMvSCxxQkFBcUI7QUFDckIsaUNBQWlDO0FBQ2pDLHVDQUF1QztBQUN2QyxnQ0FBZ0M7QUFDaEMsMENBQTBDO0FBQzFDLDRDQUE0QztBQUM1Qyx3Q0FBd0M7QUFDeEMsd0JBQXdCO0FBQ3hCLGdCQUFnQjtBQUNoQixRQUFRO0FBQ1IsS0FBSztBQUNMLE1BQU0sT0FBTyxxQkFBcUI7SUFpQjlCOzs7OztPQUtHO0lBQ0gsSUFBVyxlQUFlLENBQUMsS0FBMkI7UUFDbEQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBRUQsSUFBVyxlQUFlO1FBQ3RC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QUFXLEdBQUcsU0FBUyxDQUFDLHlCQUF5QixDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDOUUsT0FBTyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3pGLENBQUM7WUFDRCxPQUFPLEVBQUUsSUFBSTtZQUNiLFVBQVUsRUFBRSxnQkFBZ0I7U0FDL0IsQ0FBQztRQUNGLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQztRQUM1RSxJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQztRQUVqQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRTtZQUNoQixJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQyxVQUFVLENBQUM7WUFDNUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUMsY0FBYyxDQUFDO1lBQ3BELElBQUksQ0FBQyxVQUFVLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQztZQUM1QyxJQUFJLENBQUMsV0FBVyxHQUFHLGNBQWMsQ0FBQyxXQUFXLENBQUM7U0FDakQ7SUFDTCxDQUFDO0NBSUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHcmlkUmVzb3VyY2VTdHJpbmdzRU4sIElHcmlkUmVzb3VyY2VTdHJpbmdzIH0gZnJvbSAnLi4vLi4vY29yZS9pMThuL2dyaWQtcmVzb3VyY2VzJztcbmltcG9ydCB7IGdldEN1cnJlbnRSZXNvdXJjZVN0cmluZ3MgfSBmcm9tICcuLi8uLi9jb3JlL2kxOG4vcmVzb3VyY2VzJztcbmltcG9ydCB7IEdyaWRDb2x1bW5EYXRhVHlwZSB9IGZyb20gJy4uLy4uL2RhdGEtb3BlcmF0aW9ucy9kYXRhLXV0aWwnO1xuaW1wb3J0IHsgSVBpdm90RGltZW5zaW9uIH0gZnJvbSAnLi9waXZvdC1ncmlkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQaXZvdFV0aWwgfSBmcm9tICcuL3Bpdm90LXV0aWwnO1xuXG5leHBvcnQgaW50ZXJmYWNlIElQaXZvdERhdGVEaW1lbnNpb25PcHRpb25zIHtcbiAgICAvKiogRW5hYmxlcy9EaXNhYmxlcyB0b3RhbCB2YWx1ZSBvZiBhbGwgcGVyaW9kcy4gKi9cbiAgICB0b3RhbD86IGJvb2xlYW47XG4gICAgLyoqIEVuYWJsZXMvRGlzYWJsZXMgZGltZW5zaW9ucyBwZXIgeWVhciBmcm9tIHByb3ZpZGVkIHBlcmlvZHMuICovXG4gICAgeWVhcnM/OiBib29sZWFuO1xuICAgIC8qLyoqIEVuYWJsZXMvRGlzYWJsZXMgZGltZW5zaW9ucyBwZXIgcXVhcnRlciBmcm9tIHByb3ZpZGVkIHBlcmlvZHMuICovXG4gICAgcXVhcnRlcnM/OiBib29sZWFuO1xuICAgIC8qKiBFbmFibGVzL0Rpc2FibGVzIGRpbWVuc2lvbnMgcGVyIG1vbnRoIGZyb20gcHJvdmlkZWQgcGVyaW9kcy4gKi9cbiAgICBtb250aHM/OiBib29sZWFuO1xuICAgIC8qKiBFbmFibGVkL0Rpc2FibGVzIGRpbWVuc2lvbnMgZm9yIHRoZSBmdWxsIGRhdGUgcHJvdmlkZWQgKi9cbiAgICBmdWxsRGF0ZT86IGJvb2xlYW47XG59XG5cbi8vIEVxdWFscyB0byBwcmV0dHkgbXVjaCB0aGlzIGNvbmZpZ3VyYXRpb246XG4vLyB7XG4vLyAgICAgbWVtYmVyOiAoKSA9PiAnQWxsIFBlcmlvZHMnLFxuLy8gICAgIGVuYWJsZWQ6IHRydWUsXG4vLyAgICAgZmllbGROYW1lOiAnQWxsUGVyaW9kcycsXG4vLyAgICAgY2hpbGRMZXZlbDoge1xuLy8gICAgICAgICBmaWVsZE5hbWU6ICdZZWFycycsXG4vLyAgICAgICAgIG1lbWJlcjogKHJlYykgPT4ge1xuLy8gICAgICAgICAgICAgY29uc3QgcmVjb3JkVmFsdWUgPSByZWNbJ0RhdGUnXTtcbi8vICAgICAgICAgICAgIHJldHVybiByZWNvcmRWYWx1ZSA/IChuZXcgRGF0ZShyZWNvcmRWYWx1ZSkpLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKSA6IHJlY1snWWVhcnMnXTtcbi8vICAgICAgICAgfSxcbi8vICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbi8vICAgICAgICAgY2hpbGRMZXZlbDoge1xuLy8gICAgICAgICAgICAgICAgIG1lbWJlcjogKHJlYykgPT4ge1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvcmRWYWx1ZSA9IHJlY1snRGF0ZSddO1xuLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkVmFsdWUgPyBuZXcgRGF0ZShyZWNvcmRWYWx1ZSkudG9Mb2NhbGVTdHJpbmcoJ2RlZmF1bHQnLCB7IG1vbnRoOiAnbG9uZycgfSkgOiByZWNbJ01vbnRocyddO1xuLy8gICAgICAgICAgICAgICAgIH0sXG4vLyAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbi8vICAgICAgICAgICAgICAgICBmaWVsZE5hbWU6ICdNb250aHMnLFxuLy8gICAgICAgICAgICAgICAgIGNoaWxkTGV2ZWw6IHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIG1lbWJlcjogJ0RhdGUnLFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgZmllbGROYW1lOidEYXRlJyxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWVcbi8vICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfVxuLy8gICAgIH1cbi8vIH0sXG5leHBvcnQgY2xhc3MgSWd4UGl2b3REYXRlRGltZW5zaW9uIGltcGxlbWVudHMgSVBpdm90RGltZW5zaW9uIHtcbiAgICAvKiogRW5hYmxlcy9EaXNhYmxlcyBhIHBhcnRpY3VsYXIgZGltZW5zaW9uIGZyb20gcGl2b3Qgc3RydWN0dXJlLiAqL1xuICAgIHB1YmxpYyBlbmFibGVkID0gdHJ1ZTtcblxuICAgIC8qKlxuICAgICAqIEdldHMvU2V0cyBkYXRhIHR5cGVcbiAgICAgKi9cbiAgICBwdWJsaWMgZGF0YVR5cGU/OiBHcmlkQ29sdW1uRGF0YVR5cGU7XG5cbiAgICAvKiogRGVmYXVsdCBvcHRpb25zLiAqL1xuICAgIHB1YmxpYyBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgdG90YWw6IHRydWUsXG4gICAgICAgIHllYXJzOiB0cnVlLFxuICAgICAgICBtb250aHM6IHRydWUsXG4gICAgICAgIGZ1bGxEYXRlOiB0cnVlXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldHMvU2V0cyB0aGUgcmVzb3VyY2Ugc3RyaW5ncy5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogQnkgZGVmYXVsdCBpdCB1c2VzIEVOIHJlc291cmNlcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgc2V0IHJlc291cmNlU3RyaW5ncyh2YWx1ZTogSUdyaWRSZXNvdXJjZVN0cmluZ3MpIHtcbiAgICAgICAgdGhpcy5fcmVzb3VyY2VTdHJpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5fcmVzb3VyY2VTdHJpbmdzLCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCByZXNvdXJjZVN0cmluZ3MoKTogSUdyaWRSZXNvdXJjZVN0cmluZ3Mge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVzb3VyY2VTdHJpbmdzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMvU2V0cyB0aGUgYmFzZSBkaW1lbnNpb24gdGhhdCBpcyB1c2VkIGJ5IHRoaXMgY2xhc3MgdG8gZGV0ZXJtaW5lIHRoZSBvdGhlciBkaW1lbnNpb25zIGFuZCB0aGVpciB2YWx1ZXMuXG4gICAgICogSGF2aW5nIGJhc2UgZGltZW5zaW9uIHNldCBpcyByZXF1aXJlZCBpbiBvcmRlciBmb3IgdGhlIERhdGUgRGltZW5zaW9ucyB0byBzaG93LlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgYmFzZURpbWVuc2lvbigpOiBJUGl2b3REaW1lbnNpb24ge1xuICAgICAgICByZXR1cm4gdGhpcy5fYmFzZURpbWVuc2lvbjtcbiAgICB9XG4gICAgcHVibGljIHNldCBiYXNlRGltZW5zaW9uKHZhbHVlOiBJUGl2b3REaW1lbnNpb24pIHtcbiAgICAgICAgdGhpcy5fYmFzZURpbWVuc2lvbiA9IHZhbHVlO1xuICAgICAgICB0aGlzLmluaXRpYWxpemUodGhpcy5iYXNlRGltZW5zaW9uLCB0aGlzLm9wdGlvbnMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMvU2V0cyB0aGUgb3B0aW9ucyBmb3IgdGhlIHByZWRlZmluZWQgZGF0ZSBkaW1lbnNpb25zIHdoZXRoZXIgdG8gc2hvdyBxdWFydGVyLCB5ZWFycyBhbmQgZXRjLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgb3B0aW9ucygpOiBJUGl2b3REYXRlRGltZW5zaW9uT3B0aW9ucyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICAgIH1cbiAgICBwdWJsaWMgc2V0IG9wdGlvbnModmFsdWU6IElQaXZvdERhdGVEaW1lbnNpb25PcHRpb25zKSB7XG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuYmFzZURpbWVuc2lvbikge1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplKHRoaXMuYmFzZURpbWVuc2lvbiwgdGhpcy5vcHRpb25zKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMTUuMS4wLiBVc2UgdGhlIGBiYXNlRGltZW5zaW9uYCBwcm9wZXJ0eSBpbnN0ZWFkLlxuICAgICAqXG4gICAgICogR2V0cyB0aGUgYmFzZSBkaW1lbnNpb24gdGhhdCBpcyB1c2VkIGJ5IHRoaXMgY2xhc3MgdG8gZGV0ZXJtaW5lIHRoZSBvdGhlciBkaW1lbnNpb25zIGFuZCB0aGVpciB2YWx1ZXMuXG4gICAgICogSGF2aW5nIGJhc2UgZGltZW5zaW9uIHNldCBpcyByZXF1aXJlZCBpbiBvcmRlciBmb3IgdGhlIERhdGUgRGltZW5zaW9ucyB0byBzaG93LlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgaW5CYXNlRGltZW5zaW9uKCk6IElQaXZvdERpbWVuc2lvbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9iYXNlRGltZW5zaW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMTUuMS4wLiBVc2UgdGhlIGBvcHRpb25zYCBwcm9wZXJ0eSBpbnN0ZWFkLlxuICAgICAqXG4gICAgICogR2V0cyB0aGUgb3B0aW9ucyBmb3IgdGhlIHByZWRlZmluZWQgZGF0ZSBkaW1lbnNpb25zIHdoZXRoZXIgdG8gc2hvdyBxdWFydGVyLCB5ZWFycyBhbmQgZXRjLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgaW5PcHRpb25zKCk6IElQaXZvdERhdGVEaW1lbnNpb25PcHRpb25zIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gICAgfVxuXG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIGNoaWxkTGV2ZWw/OiBJUGl2b3REaW1lbnNpb247XG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIG1lbWJlck5hbWUgPSAnQWxsUGVyaW9kcyc7XG4gICAgcHVibGljIGRpc3BsYXlOYW1lOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBfcmVzb3VyY2VTdHJpbmdzID0gZ2V0Q3VycmVudFJlc291cmNlU3RyaW5ncyhHcmlkUmVzb3VyY2VTdHJpbmdzRU4pO1xuICAgIHByaXZhdGUgX2Jhc2VEaW1lbnNpb246IElQaXZvdERpbWVuc2lvbjtcbiAgICBwcml2YXRlIF9vcHRpb25zOiBJUGl2b3REYXRlRGltZW5zaW9uT3B0aW9ucyA9IHt9O1xuICAgIHByaXZhdGUgX21vbnRoSW50bCA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KCdkZWZhdWx0JywgeyBtb250aDogJ2xvbmcnIH0pO1xuXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFkZGl0aW9uYWwgcGl2b3QgZGF0ZSBkaW1lbnNpb25zIGJhc2VkIG9uIGEgcHJvdmlkZWQgZGltZW5zaW9uIGRlc2NyaWJpbmcgZGF0ZSBkYXRhOlxuICAgICAqXG4gICAgICogQHBhcmFtIGluRGF0ZURpbWVuc2lvbiBCYXNlIGRpbWVuc2lvbiB0aGF0IGlzIHVzZWQgYnkgdGhpcyBjbGFzcyB0byBkZXRlcm1pbmUgdGhlIG90aGVyIGRpbWVuc2lvbnMgYW5kIHRoZWlyIHZhbHVlcy5cbiAgICAgKiBAcGFyYW0gaW5PcHRpb25zIE9wdGlvbnMgZm9yIHRoZSBwcmVkZWZpbmVkIGRhdGUgZGltZW5zaW9ucyB3aGV0aGVyIHRvIHNob3cgcXVhcnRlciwgeWVhcnMgYW5kIGV0Yy5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiAvLyBEaXNwbGF5cyBvbmx5IHllYXJzIGFzIHBhcmVudCBkaW1lbnNpb24gdG8gdGhlIGJhc2UgZGltZW5zaW9uIHByb3ZpZGVkLlxuICAgICAqIG5ldyBJZ3hQaXZvdERhdGVEaW1lbnNpb24oeyBtZW1iZXJOYW1lOiAnRGF0ZScsIGVuYWJsZWQ6IHRydWUgfSwgeyB0b3RhbDogZmFsc2UsIG1vbnRoczogZmFsc2UgfSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoaW5CYXNlRGltZW5zaW9uOiBJUGl2b3REaW1lbnNpb24sIGluT3B0aW9uczogSVBpdm90RGF0ZURpbWVuc2lvbk9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLl9iYXNlRGltZW5zaW9uID0gaW5CYXNlRGltZW5zaW9uO1xuICAgICAgICB0aGlzLl9vcHRpb25zID0gaW5PcHRpb25zO1xuICAgICAgICBpZiAodGhpcy5iYXNlRGltZW5zaW9uICYmIHRoaXMub3B0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplKHRoaXMuYmFzZURpbWVuc2lvbiwgdGhpcy5vcHRpb25zKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBpbml0aWFsaXplKGluQmFzZURpbWVuc2lvbiwgaW5PcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7IC4uLnRoaXMuZGVmYXVsdE9wdGlvbnMsIC4uLmluT3B0aW9ucyB9O1xuXG4gICAgICAgIHRoaXMuZGF0YVR5cGUgPSBHcmlkQ29sdW1uRGF0YVR5cGUuRGF0ZTtcbiAgICAgICAgaW5CYXNlRGltZW5zaW9uLmRhdGFUeXBlID0gR3JpZENvbHVtbkRhdGFUeXBlLkRhdGU7XG5cbiAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IGluQmFzZURpbWVuc2lvbi5kaXNwbGF5TmFtZSB8fCB0aGlzLnJlc291cmNlU3RyaW5ncy5pZ3hfZ3JpZF9waXZvdF9kYXRlX2RpbWVuc2lvbl90b3RhbDtcblxuICAgICAgICBjb25zdCBiYXNlRGltZW5zaW9uID0gb3B0aW9ucy5mdWxsRGF0ZSA/IGluQmFzZURpbWVuc2lvbiA6IG51bGw7XG4gICAgICAgIGNvbnN0IG1vbnRoRGltZW5zaW9uRGVmOiBJUGl2b3REaW1lbnNpb24gPSB7XG4gICAgICAgICAgICBtZW1iZXJOYW1lOiAnTW9udGhzJyxcbiAgICAgICAgICAgIG1lbWJlckZ1bmN0aW9uOiAocmVjKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkVmFsdWUgPSBQaXZvdFV0aWwuZXh0cmFjdFZhbHVlRnJvbURpbWVuc2lvbihpbkJhc2VEaW1lbnNpb24sIHJlYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFZhbHVlID8gdGhpcy5fbW9udGhJbnRsLmZvcm1hdChuZXcgRGF0ZShyZWNvcmRWYWx1ZSkpIDogcmVjWydNb250aHMnXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgY2hpbGRMZXZlbDogYmFzZURpbWVuc2lvblxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBtb250aERpbWVuc2lvbiA9IG9wdGlvbnMubW9udGhzID8gbW9udGhEaW1lbnNpb25EZWYgOiBiYXNlRGltZW5zaW9uO1xuXG4gICAgICAgIGNvbnN0IHF1YXJ0ZXJEaW1lbnNpb25EZWY6IElQaXZvdERpbWVuc2lvbiA9IHtcbiAgICAgICAgICAgIG1lbWJlck5hbWU6ICdRdWFydGVycycsXG4gICAgICAgICAgICBtZW1iZXJGdW5jdGlvbjogKHJlYykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZFZhbHVlID0gUGl2b3RVdGlsLmV4dHJhY3RWYWx1ZUZyb21EaW1lbnNpb24oaW5CYXNlRGltZW5zaW9uLCByZWMpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNvcmRWYWx1ZSA/IGBRYCArIE1hdGguY2VpbCgobmV3IERhdGUocmVjb3JkVmFsdWUpLmdldE1vbnRoKCkgKyAxKSAvIDMpIDogcmVjWydRdWFydGVycyddO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBjaGlsZExldmVsOiBtb250aERpbWVuc2lvblxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBxdWFydGVyRGltZW5zaW9uID0gb3B0aW9ucy5xdWFydGVycyA/IHF1YXJ0ZXJEaW1lbnNpb25EZWYgOiBtb250aERpbWVuc2lvbjtcblxuICAgICAgICBjb25zdCB5ZWFyc0RpbWVuc2lvbkRlZjogSVBpdm90RGltZW5zaW9uID0ge1xuICAgICAgICAgICAgbWVtYmVyTmFtZTogJ1llYXJzJyxcbiAgICAgICAgICAgIG1lbWJlckZ1bmN0aW9uOiAocmVjKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkVmFsdWUgPSBQaXZvdFV0aWwuZXh0cmFjdFZhbHVlRnJvbURpbWVuc2lvbihpbkJhc2VEaW1lbnNpb24sIHJlYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFZhbHVlID8gKG5ldyBEYXRlKHJlY29yZFZhbHVlKSkuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpIDogcmVjWydZZWFycyddO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBjaGlsZExldmVsOiBxdWFydGVyRGltZW5zaW9uXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHllYXJzRGltZW5zaW9uID0gb3B0aW9ucy55ZWFycyA/IHllYXJzRGltZW5zaW9uRGVmIDogcXVhcnRlckRpbWVuc2lvbjtcbiAgICAgICAgdGhpcy5jaGlsZExldmVsID0geWVhcnNEaW1lbnNpb247XG5cbiAgICAgICAgaWYgKCFvcHRpb25zLnRvdGFsKSB7XG4gICAgICAgICAgICB0aGlzLm1lbWJlck5hbWUgPSB5ZWFyc0RpbWVuc2lvbi5tZW1iZXJOYW1lO1xuICAgICAgICAgICAgdGhpcy5tZW1iZXJGdW5jdGlvbiA9IHllYXJzRGltZW5zaW9uLm1lbWJlckZ1bmN0aW9uO1xuICAgICAgICAgICAgdGhpcy5jaGlsZExldmVsID0geWVhcnNEaW1lbnNpb24uY2hpbGRMZXZlbDtcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSB5ZWFyc0RpbWVuc2lvbi5kaXNwbGF5TmFtZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBtZW1iZXJGdW5jdGlvbiA9IChfZGF0YSkgPT4gdGhpcy5yZXNvdXJjZVN0cmluZ3MuaWd4X2dyaWRfcGl2b3RfZGF0ZV9kaW1lbnNpb25fdG90YWw7XG59XG4iXX0=