import { Inject, Pipe } from '@angular/core';
import { SortingDirection } from '../data-operations/sorting-strategy';
import { IGX_COMBO_COMPONENT } from './combo.common';
import * as i0 from "@angular/core";
/** @hidden */
export class IgxComboFilteringPipe {
    transform(collection, searchValue, displayKey, filteringOptions, filterFunction = defaultFilterFunction) {
        if (!collection) {
            return [];
        }
        if (!filteringOptions.filterable) {
            return collection;
        }
        filteringOptions.filteringKey = filteringOptions.filteringKey ?? displayKey;
        return filterFunction(collection, searchValue, filteringOptions);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: IgxComboFilteringPipe, deps: [], target: i0.ɵɵFactoryTarget.Pipe }); }
    static { this.ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "17.2.4", ngImport: i0, type: IgxComboFilteringPipe, isStandalone: true, name: "comboFiltering" }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: IgxComboFilteringPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'comboFiltering',
                    standalone: true
                }]
        }] });
/** @hidden */
export class IgxComboGroupingPipe {
    constructor(combo) {
        this.combo = combo;
    }
    transform(collection, groupKey, valueKey, sortingDirection, compareCollator) {
        // TODO: should filteredData be changed here?
        this.combo.filteredData = collection;
        if ((!groupKey && groupKey !== 0) || !collection.length) {
            return collection;
        }
        const groups = Object.entries(groupBy(collection, (item) => item[groupKey] ?? 'Other'));
        if (sortingDirection !== SortingDirection.None) {
            const reverse = sortingDirection === SortingDirection.Desc ? -1 : 1;
            groups.sort((a, b) => {
                return compareCollator.compare(a[0], b[0]) * reverse;
            });
        }
        const result = groups.flatMap(([_, items]) => {
            items.unshift({
                isHeader: true,
                [valueKey]: items[0][groupKey],
                [groupKey]: items[0][groupKey]
            });
            return items;
        });
        return result;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: IgxComboGroupingPipe, deps: [{ token: IGX_COMBO_COMPONENT }], target: i0.ɵɵFactoryTarget.Pipe }); }
    static { this.ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "17.2.4", ngImport: i0, type: IgxComboGroupingPipe, isStandalone: true, name: "comboGrouping" }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: IgxComboGroupingPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'comboGrouping',
                    standalone: true
                }]
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [IGX_COMBO_COMPONENT]
                }] }] });
function defaultFilterFunction(collection, searchValue, filteringOptions) {
    if (!searchValue) {
        return collection;
    }
    const { caseSensitive, filteringKey } = filteringOptions;
    const term = caseSensitive ? searchValue : searchValue.toLowerCase();
    return collection.filter(item => {
        const str = filteringKey ? `${item[filteringKey]}` : `${item}`;
        return (caseSensitive ? str : str.toLowerCase()).includes(term);
    });
}
function normalizeString(str, caseSensitive = false) {
    return (caseSensitive ? str : str.toLocaleLowerCase())
        .normalize('NFKD')
        .replace(/\p{M}/gu, '');
}
function groupBy(data, key) {
    const result = {};
    const _get = typeof key === 'function' ? key : (item) => item[key];
    for (const item of data) {
        const category = _get(item);
        const group = result[category];
        Array.isArray(group) ? group.push(item) : (result[category] = [item]);
    }
    return result;
}
/**
 * Combo filter function which does not distinguish between accented letters and their base letters.
 * For example, when filtering for "resume", this function will match both "resume" and "résumé".
 *
 * @example
 * ```html
 * <igx-combo [filterFunction]="comboIgnoreDiacriticFilterFunction"></igx-combo>
 * ```
 */
export function comboIgnoreDiacriticsFilter(collection, searchValue, filteringOptions) {
    if (!searchValue) {
        return collection;
    }
    const { caseSensitive, filteringKey } = filteringOptions;
    const term = normalizeString(searchValue, caseSensitive);
    return collection.filter(item => {
        const str = filteringKey ? `${item[filteringKey]}` : `${item}`;
        return normalizeString(str, caseSensitive).includes(term);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8ucGlwZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZ25pdGV1aS1hbmd1bGFyL3NyYy9saWIvY29tYm8vY29tYm8ucGlwZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBQzVELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBd0MsbUJBQW1CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7QUFFM0YsY0FBYztBQUtkLE1BQU0sT0FBTyxxQkFBcUI7SUFDdkIsU0FBUyxDQUNaLFVBQWlCLEVBQ2pCLFdBQWdCLEVBQ2hCLFVBQWUsRUFDZixnQkFBd0MsRUFDeEMsaUJBQTJHLHFCQUFxQjtRQUNoSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2IsT0FBTyxFQUFFLENBQUM7U0FDYjtRQUNELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUU7WUFDOUIsT0FBTyxVQUFVLENBQUM7U0FDckI7UUFDRCxnQkFBZ0IsQ0FBQyxZQUFZLEdBQUcsZ0JBQWdCLENBQUMsWUFBWSxJQUFJLFVBQVUsQ0FBQztRQUM1RSxPQUFPLGNBQWMsQ0FBQyxVQUFVLEVBQUUsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDckUsQ0FBQzs4R0FmUSxxQkFBcUI7NEdBQXJCLHFCQUFxQjs7MkZBQXJCLHFCQUFxQjtrQkFKakMsSUFBSTttQkFBQztvQkFDRixJQUFJLEVBQUUsZ0JBQWdCO29CQUN0QixVQUFVLEVBQUUsSUFBSTtpQkFDbkI7O0FBbUJELGNBQWM7QUFLZCxNQUFNLE9BQU8sb0JBQW9CO0lBRTdCLFlBQWdELEtBQW1CO1FBQW5CLFVBQUssR0FBTCxLQUFLLENBQWM7SUFBSSxDQUFDO0lBRWpFLFNBQVMsQ0FBQyxVQUFpQixFQUFFLFFBQWEsRUFBRSxRQUFhLEVB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QyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDO1FBQy9ELE9BQU8sZUFBZSxDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUQsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBQaXBlLCBQaXBlVHJhbnNmb3JtIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTb3J0aW5nRGlyZWN0aW9uIH0gZnJvbSAnLi4vZGF0YS1vcGVyYXRpb25zL3NvcnRpbmctc3RyYXRlZ3knO1xuaW1wb3J0IHsgSUNvbWJvRmlsdGVyaW5nT3B0aW9ucywgSWd4Q29tYm9CYXNlLCBJR1hfQ09NQk9fQ09NUE9ORU5UIH0gZnJvbSAnLi9jb21iby5jb21tb24nO1xuXG4vKiogQGhpZGRlbiAqL1xuQFBpcGUoe1xuICAgIG5hbWU6ICdjb21ib0ZpbHRlcmluZycsXG4gICAgc3RhbmRhbG9uZTogdHJ1ZVxufSlcbmV4cG9ydCBjbGFzcyBJZ3hDb21ib0ZpbHRlcmluZ1BpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcbiAgICBwdWJsaWMgdHJhbnNmb3JtKFxuICAgICAgICBjb2xsZWN0aW9uOiBhbnlbXSxcbiAgICAgICAgc2VhcmNoVmFsdWU6IGFueSxcbiAgICAgICAgZGlzcGxheUtleTogYW55LFxuICAgICAgICBmaWx0ZXJpbmdPcHRpb25zOiBJQ29tYm9GaWx0ZXJpbmdPcHRpb25zLFxuICAgICAgICBmaWx0ZXJGdW5jdGlvbjogKGNvbGxlY3Rpb246IGFueVtdLCBzZWFyY2hWYWx1ZTogYW55LCBmaWx0ZXJpbmdPcHRpb25zOiBJQ29tYm9GaWx0ZXJpbmdPcHRpb25zKSA9PiBhbnlbXSA9IGRlZmF1bHRGaWx0ZXJGdW5jdGlvbikge1xuICAgICAgICBpZiAoIWNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWZpbHRlcmluZ09wdGlvbnMuZmlsdGVyYWJsZSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgZmlsdGVyaW5nT3B0aW9ucy5maWx0ZXJpbmdLZXkgPSBmaWx0ZXJpbmdPcHRpb25zLmZpbHRlcmluZ0tleSA/PyBkaXNwbGF5S2V5O1xuICAgICAgICByZXR1cm4gZmlsdGVyRnVuY3Rpb24oY29sbGVjdGlvbiwgc2VhcmNoVmFsdWUsIGZpbHRlcmluZ09wdGlvbnMpO1xuICAgIH1cbn1cblxuLyoqIEBoaWRkZW4gKi9cbkBQaXBlKHtcbiAgICBuYW1lOiAnY29tYm9Hcm91cGluZycsXG4gICAgc3RhbmRhbG9uZTogdHJ1ZVxufSlcbmV4cG9ydCBjbGFzcyBJZ3hDb21ib0dyb3VwaW5nUGlwZSBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xuXG4gICAgY29uc3RydWN0b3IoQEluamVjdChJR1hfQ09NQk9fQ09NUE9ORU5UKSBwdWJsaWMgY29tYm86IElneENvbWJvQmFzZSkgeyB9XG5cbiAgICBwdWJsaWMgdHJhbnNmb3JtKGNvbGxlY3Rpb246IGFueVtdLCBncm91cEtleTogYW55LCB2YWx1ZUtleTogYW55LCBzb3J0aW5nRGlyZWN0aW9uOiBTb3J0aW5nRGlyZWN0aW9uLCBjb21wYXJlQ29sbGF0b3I6IEludGwuQ29sbGF0b3IpIHtcbiAgICAgICAgLy8gVE9ETzogc2hvdWxkIGZpbHRlcmVkRGF0YSBiZSBjaGFuZ2VkIGhlcmU/XG4gICAgICAgIHRoaXMuY29tYm8uZmlsdGVyZWREYXRhID0gY29sbGVjdGlvbjtcbiAgICAgICAgaWYgKCghZ3JvdXBLZXkgJiYgZ3JvdXBLZXkgIT09IDApIHx8ICFjb2xsZWN0aW9uLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZ3JvdXBzID0gT2JqZWN0LmVudHJpZXMoZ3JvdXBCeShjb2xsZWN0aW9uLCAoaXRlbSkgPT4gaXRlbVtncm91cEtleV0gPz8gJ090aGVyJykpO1xuICAgICAgICBpZiAoc29ydGluZ0RpcmVjdGlvbiAhPT0gU29ydGluZ0RpcmVjdGlvbi5Ob25lKSB7XG4gICAgICAgICAgICBjb25zdCByZXZlcnNlID0gc29ydGluZ0RpcmVjdGlvbiA9PT0gU29ydGluZ0RpcmVjdGlvbi5EZXNjID8gLTEgOiAxO1xuICAgICAgICAgICAgZ3JvdXBzLnNvcnQoKGEsYikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wYXJlQ29sbGF0b3IuY29tcGFyZShhWzBdLCBiWzBdKSAqIHJldmVyc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXN1bHQgPSBncm91cHMuZmxhdE1hcCgoW18sIGl0ZW1zXSkgPT4ge1xuICAgICAgICAgICAgaXRlbXMudW5zaGlmdCh7XG4gICAgICAgICAgICAgICAgaXNIZWFkZXI6IHRydWUsXG4gICAgICAgICAgICAgICAgW3ZhbHVlS2V5XTogaXRlbXNbMF1bZ3JvdXBLZXldLFxuICAgICAgICAgICAgICAgIFtncm91cEtleV06IGl0ZW1zWzBdW2dyb3VwS2V5XVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiBpdGVtcztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkZWZhdWx0RmlsdGVyRnVuY3Rpb248VD4oY29sbGVjdGlvbjogVFtdLCBzZWFyY2hWYWx1ZTogc3RyaW5nLCBmaWx0ZXJpbmdPcHRpb25zOiBJQ29tYm9GaWx0ZXJpbmdPcHRpb25zKTogVFtdIHtcbiAgICBpZiAoIXNlYXJjaFZhbHVlKSB7XG4gICAgICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICAgIH1cblxuICAgIGNvbnN0IHsgY2FzZVNlbnNpdGl2ZSwgZmlsdGVyaW5nS2V5IH0gPSBmaWx0ZXJpbmdPcHRpb25zO1xuICAgIGNvbnN0IHRlcm0gPSBjYXNlU2Vuc2l0aXZlID8gc2VhcmNoVmFsdWUgOiBzZWFyY2hWYWx1ZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgcmV0dXJuIGNvbGxlY3Rpb24uZmlsdGVyKGl0ZW0gPT4ge1xuICAgICAgICBjb25zdCBzdHIgPSBmaWx0ZXJpbmdLZXkgPyBgJHtpdGVtW2ZpbHRlcmluZ0tleV19YCA6IGAke2l0ZW19YDtcbiAgICAgICAgcmV0dXJuIChjYXNlU2Vuc2l0aXZlID8gc3RyIDogc3RyLnRvTG93ZXJDYXNlKCkpLmluY2x1ZGVzKHRlcm0pO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVTdHJpbmcoc3RyOiBzdHJpbmcsIGNhc2VTZW5zaXRpdmUgPSBmYWxzZSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIChjYXNlU2Vuc2l0aXZlID8gc3RyIDogc3RyLnRvTG9jYWxlTG93ZXJDYXNlKCkpXG4gICAgICAgIC5ub3JtYWxpemUoJ05GS0QnKVxuICAgICAgICAucmVwbGFjZSgvXFxwe019L2d1LCAnJyk7XG59XG5cbmZ1bmN0aW9uIGdyb3VwQnk8VD4oZGF0YTogVFtdLCBrZXk6IGtleW9mIFQgfCAoKGl0ZW06IFQpID0+IGFueSkpIHtcbiAgICBjb25zdCByZXN1bHQ6IFJlY29yZDxzdHJpbmcsIFRbXT4gPSB7fTtcbiAgICBjb25zdCBfZ2V0ID0gdHlwZW9mIGtleSA9PT0gJ2Z1bmN0aW9uJyA/IGtleSA6IChpdGVtOiBUKSA9PiBpdGVtW2tleV07XG5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZGF0YSkge1xuICAgICAgY29uc3QgY2F0ZWdvcnkgPSBfZ2V0KGl0ZW0pO1xuICAgICAgY29uc3QgZ3JvdXAgPSByZXN1bHRbY2F0ZWdvcnldO1xuICBcbiAgICAgIEFycmF5LmlzQXJyYXkoZ3JvdXApID8gZ3JvdXAucHVzaChpdGVtKSA6IChyZXN1bHRbY2F0ZWdvcnldID0gW2l0ZW1dKTtcbiAgICB9XG4gIFxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogQ29tYm8gZmlsdGVyIGZ1bmN0aW9uIHdoaWNoIGRvZXMgbm90IGRpc3Rpbmd1aXNoIGJldHdlZW4gYWNjZW50ZWQgbGV0dGVycyBhbmQgdGhlaXIgYmFzZSBsZXR0ZXJzLlxuICogRm9yIGV4YW1wbGUsIHdoZW4gZmlsdGVyaW5nIGZvciBcInJlc3VtZVwiLCB0aGlzIGZ1bmN0aW9uIHdpbGwgbWF0Y2ggYm90aCBcInJlc3VtZVwiIGFuZCBcInLDqXN1bcOpXCIuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWxcbiAqIDxpZ3gtY29tYm8gW2ZpbHRlckZ1bmN0aW9uXT1cImNvbWJvSWdub3JlRGlhY3JpdGljRmlsdGVyRnVuY3Rpb25cIj48L2lneC1jb21ibz5cbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY29tYm9JZ25vcmVEaWFjcml0aWNzRmlsdGVyPFQ+KGNvbGxlY3Rpb246IFRbXSwgc2VhcmNoVmFsdWU6IHN0cmluZywgZmlsdGVyaW5nT3B0aW9uczogSUNvbWJvRmlsdGVyaW5nT3B0aW9ucyk6IFRbXSB7XG4gICAgaWYgKCFzZWFyY2hWYWx1ZSkge1xuICAgICAgICByZXR1cm4gY29sbGVjdGlvbjtcbiAgICB9XG5cbiAgICBjb25zdCB7IGNhc2VTZW5zaXRpdmUsIGZpbHRlcmluZ0tleSB9ID0gZmlsdGVyaW5nT3B0aW9ucztcbiAgICBjb25zdCB0ZXJtID0gbm9ybWFsaXplU3RyaW5nKHNlYXJjaFZhbHVlLCBjYXNlU2Vuc2l0aXZlKTtcblxuICAgIHJldHVybiBjb2xsZWN0aW9uLmZpbHRlcihpdGVtID0+IHtcbiAgICAgICAgY29uc3Qgc3RyID0gZmlsdGVyaW5nS2V5ID8gYCR7aXRlbVtmaWx0ZXJpbmdLZXldfWAgOiBgJHtpdGVtfWA7XG4gICAgICAgIHJldHVybiBub3JtYWxpemVTdHJpbmcoc3RyLCBjYXNlU2Vuc2l0aXZlKS5pbmNsdWRlcyh0ZXJtKTtcbiAgICB9KTtcbn1cbiJdfQ==